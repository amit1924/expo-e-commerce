<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Backend Code Explained â€“ Simple Revision</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              dark: '#0f172a',
              neon: '#38bdf8',
              green: '#22c55e',
              purple: '#a855f7',
            },
            boxShadow: {
              neon: '0 0 15px rgba(56,189,248,0.6)',
            },
          },
        },
      };
    </script>
  </head>

  <body class="bg-dark text-gray-200">
    <header class="text-center py-8">
      <h1 class="text-3xl font-bold text-neon drop-shadow-[0_0_10px_#38bdf8]">
        Backend Products & Orders â€“ Full Explanation
      </h1>
      <p class="text-gray-400 mt-2">Code + explanation for fast revision ğŸ‘¨â€ğŸ«</p>
    </header>

    <main class="max-w-6xl mx-auto px-6 space-y-10">
      <!-- IMPORTS -->
      <section class="bg-slate-900 p-6 rounded-xl shadow-neon">
        <h2 class="text-xl text-green font-semibold">
          <i class="fas fa-plug"></i> Imports
        </h2>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
import cloudinary from '../config/cloudinary.js';
import Product from '../models/product.model.js';
  </pre
        >

        <p class="mt-4">
          ğŸ‘‰ <b>cloudinary</b> is used to upload images to the cloud. <br />
          ğŸ‘‰ <b>Product</b> is the MongoDB model for storing product data.
        </p>
      </section>

      <!-- CREATE PRODUCT -->
      <section class="bg-slate-900 p-6 rounded-xl shadow-neon">
        <h2 class="text-xl text-purple font-semibold">
          <i class="fas fa-plus-circle"></i> CREATE PRODUCT API
        </h2>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
export async function createProduct(req, res) {
  const { name, price, description, stock, category } = req.body;
  </pre
        >

        <p class="mt-4">
          ğŸ‘‰ Data comes from <b>req.body</b> (sent by frontend form). <br />
          ğŸ‘‰ These are basic product fields.
        </p>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
if (!name || !price || !description || !stock || !category) {
  return res.status(400).json({ message: 'All fields are required' });
}
  </pre
        >

        <p class="mt-4">
          âœ… This is <b>validation</b>. If any field is missing â†’ API stops and
          sends error.
        </p>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
if (!req.files || req.files.length === 0) {
  return res.status(400).json({ message: 'At least one image is required' });
}
  </pre
        >

        <p class="mt-4">ğŸ–¼ï¸ Product must have at least <b>one image</b>.</p>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
if (req.files.length > 3) {
  return res.status(400).json({ message: 'A maximum of 3 images are allowed' });
}
  </pre
        >

        <p class="mt-4">ğŸ“Œ Maximum <b>3 images</b> allowed (business rule).</p>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
const uploadResults = await Promise.all(
  req.files.map((file) =>
    cloudinary.uploader.upload(file.path, { folder: 'products' })
  )
);
  </pre
        >

        <p class="mt-4">
          â˜ï¸ All images are uploaded to Cloudinary. <br />
          âš¡ <b>Promise.all</b> uploads all images together (faster).
        </p>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
const imageUrls = uploadResults.map(result => ({
  url: result.secure_url
}));
  </pre
        >

        <p class="mt-4">ğŸ§  Only image URLs are saved, NOT the image file.</p>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
const product = await Product.create({
  name,
  price: parseFloat(price),
  description,
  stock: parseInt(stock),
  category,
  images: imageUrls
});
  </pre
        >

        <p class="mt-4">ğŸ’¾ Product is saved in database <b>ONLY ONCE</b>.</p>
      </section>

      <!-- GET ALL PRODUCTS -->
      <section class="bg-slate-900 p-6 rounded-xl shadow-neon">
        <h2 class="text-xl text-green font-semibold">
          <i class="fas fa-boxes"></i> GET ALL PRODUCTS
        </h2>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
const products = await Product.find().sort({ createdAt: -1 });
  </pre
        >

        <p class="mt-4">
          ğŸ“¦ Fetches all products. <br />
          â±ï¸ Newest product comes first.
        </p>
      </section>

      <!-- UPDATE PRODUCT -->
      <section class="bg-slate-900 p-6 rounded-xl shadow-neon">
        <h2 class="text-xl text-purple font-semibold">
          <i class="fas fa-edit"></i> UPDATE PRODUCT
        </h2>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
const product = await Product.findByIdAndUpdate(id);
  </pre
        >

        <p class="mt-4">ğŸ” Finds product using ID.</p>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
if (name) product.name = name;
if (price) product.price = parseFloat(price);
  </pre
        >

        <p class="mt-4">âœï¸ Only fields sent by frontend are updated.</p>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
if (req.files && req.files.length > 0) {
  // upload new images
}
  </pre
        >

        <p class="mt-4">ğŸ–¼ï¸ If new images come â†’ old images are replaced.</p>
      </section>

      <!-- GET ALL ORDERS -->
      <section class="bg-slate-900 p-6 rounded-xl shadow-neon">
        <h2 class="text-xl text-neon font-semibold">
          <i class="fas fa-receipt"></i> GET ALL ORDERS
        </h2>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
Order.find()
  .populate('user', 'name email')
  .populate('orderItems.product')
  .sort({ createdAt: -1 });
  </pre
        >

        <p class="mt-4">
          ğŸ‘¤ Adds user name & email. <br />
          ğŸ›ï¸ Adds product details inside orders. <br />
          â±ï¸ Latest orders first.
        </p>
      </section>

      <!-- UPDATE ORDER STATUS -->
      <section class="bg-slate-900 p-6 rounded-xl shadow-neon">
        <h2 class="text-xl text-green font-semibold">
          <i class="fas fa-truck"></i> UPDATE ORDER STATUS
        </h2>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
if (!['pending', 'shipped', 'delivered'].includes(status)) {
  return res.status(400).json({ message: 'Invalid status value' });
}
  </pre
        >

        <p class="mt-4">ğŸš¦ Only valid status values allowed.</p>

        <pre class="bg-black p-4 rounded-lg mt-4 text-sm text-gray-300">
if (status === 'shipped') order.shippedAt = new Date();
if (status === 'delivered') order.deliveredAt = new Date();
  </pre
        >

        <p class="mt-4">ğŸ“… Automatically records shipping & delivery time.</p>
      </section>

      <!-- FINAL SUMMARY -->
      <section class="bg-slate-900 p-6 rounded-xl shadow-neon">
        <h2 class="text-xl text-neon font-semibold">
          <i class="fas fa-check-circle"></i> Final One-Minute Revision
        </h2>

        <ul class="list-disc list-inside mt-4 space-y-1">
          <li>Products â†’ validate â†’ upload images â†’ save</li>
          <li>Images â†’ Cloudinary â†’ save URL</li>
          <li>Orders â†’ populate user & product</li>
          <li>Status â†’ controlled & timestamped</li>
        </ul>
      </section>
    </main>

    <footer class="text-center py-6 text-gray-500">
      Backend revision made simple ğŸ’™
    </footer>
  </body>
</html>
